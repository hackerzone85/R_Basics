```{r prologue, results='hide', echo=FALSE}
knitr::opts_chunk$set(warning = FALSE
                      , message = FALSE
                      , echo = FALSE
                      )
```

```{r setup}
require(vcd)
require(vcdExtra)
require(MASS)
```

---
title: "VCD Exercise 9"
author: "Julian Hatwell"
date: "March 29, 2016"
output: html_document
---

9.1 Consider the data set DaytonSurvey (described in Example 2.6), giving results of a survey of use of alcohol (A), cigarettes (C), and marijuana (M) among high school seniors. For this exercise, ignore the variables sex and race, by working with the marginal table Dayton.ACM, a 2 × 2 × 2 table in frequency data frame form.

```{r, echo=TRUE}
Dayton.ACM <- aggregate(Freq ~ cigarette + alcohol + marijuana, data = DaytonSurvey, FUN = sum)
structable(~cigarette + alcohol + marijuana, Dayton.ACM)
```

(a)	Use loglm () to fit the model of mutual independence, [A][C][M].

```{r}
day.llm0 <- loglm(Freq~cigarette + alcohol + marijuana
                 , data = DaytonSurvey
                 , param = TRUE
                 , fitted = TRUE)
day.llm0

print("Fitted Frequencies")
round(structable(~cigarette + alcohol + marijuana
           , fitted(day.llm0)),0)
```

(b)	Prepare mosaic display(s) for associations among these variables. Give a verbal description of the association between cigarette and alcohol use.

```{r}
mosaic(round(structable(~cigarette + alcohol + marijuana
           , fitted(day.llm0)),0)
       , main = "Model: [Alcohol][Cigarettes][Marijuana]"
       , labeling = labeling_values)

mosaic(structable(Freq~cigarette + alcohol + marijuana
                  , Dayton.ACM)
       , shade = TRUE
       , main = "Observed Frequencies"
       , labeling = labeling_values
       , legend = FALSE)
```

(c)	Use fourfold () to produce fourfold plots for each pair of variables, AC, AM, and CM, stratified by the remaining one. Describe these associations verbally.

```{r}
Dayton.dft <- expand.dft(Dayton.ACM)
Dayton.tab <- table(Dayton.dft)
fourfold(Dayton.tab)
fourfold(aperm(Dayton.tab, c(1,3,2)))
fourfold(aperm(Dayton.tab, c(3,2,1)))
```

*It appears as though each variable is strongly associated with the other regardless of the third. Specifically, if you use cigarettes, you are much more likely to use alcohol, regardelss of marijuana use. If you use marijuana, you are much more likely to use cigarettes regardless of alcohol use. If you use alcohol you are much more likely to use marijuana, regardless of cigarette use. The same holds in every direction.*

## 9.2 Continue the analysis of the DaytonSurvey data by fitting the following models:

(a)	Joint independence, [AC][M]

*Adding the mutual independence model with glm first.*

```{r}
day.glm0 <- glm(Freq~cigarette + alcohol + marijuana
                , data = DaytonSurvey
                , family = poisson)
day.glm0
```

*Now the join model.*

```{r}
day.glm1 <- glm(Freq~cigarette * alcohol + marijuana
                , data = DaytonSurvey
                , family = poisson)
day.glm1
```

(b)	Conditional independence, [AM][CM]

```{r}
day.glm2 <- glm(Freq~(cigarette + alcohol) * marijuana
                , data = DaytonSurvey
                , family = poisson)
day.glm2
```

(c)	Homogeneous association, [AC][AM][CM]

```{r}
day.glm3 <- glm(Freq~(cigarette + alcohol + marijuana)^2
                , data = DaytonSurvey
                , family = poisson)
day.glm3
```

*Adding the saturated model*

```{r}
day.glm4 <- glm(Freq~(cigarette + alcohol + marijuana)^3
                , data = DaytonSurvey
                , family = poisson)
day.glm4
```

(d)	Prepare a table giving the goodness-of-fit tests for these models, as well as the model of mutual independence, [A][C][M], and the saturated model, [ACM]. Hint: anova() and LRstats() are useful here. Which model appears to give the most reasonable fit?

```{r}
anova(day.glm4, test = "Chisq")
anova(day.glm0, day.glm1, day.glm2, day.glm3, day.glm4)
LRstats(day.glm0, day.glm1, day.glm2, day.glm3, day.glm4)
```

*The homogenous dependency model appears to be the best one. The three-way interaction term adds very little.*
