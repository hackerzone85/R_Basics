```{r prologue, results='hide', echo=FALSE}
knitr::opts_chunk$set(warning = FALSE
                      , message = FALSE
                      , echo = FALSE
                      )
```

```{r setup}
library(dplyr)
library(reshape2)
library(ggplot2)
```

---
title: "A brief analysis of the Global Terrorism Database"
author: "Julian Hatwell"
date: "March 29, 2016"
output: html_document
---

This post is inspired by a recent [article in the Huffington Post](http://www.huffingtonpost.co.uk/2015/11/28/islamic-state-terrorism-threat_n_8670458.html) which contained a [barchart of fatalities][1] caused by terrorism in 5 Western European countries over the years since 1970.

The original source of the data is the [Global Terrorism Database](https://www.start.umd.edu/gtd/), which is freely available to download.

In my opinion, the graph is a fairly successful attempt to demonstrate that our current perception and fear of global terrorism is caused by something other than factual measures such as the number of deaths. It may be more a symptom of the tactics of terror or simply the dominant socio-political narrative.

My reposting of the graphic on Facebook drew the attention of one particular friend who asserted that the graph wasn't making a valid comparison to current Islamic Terrorism because it "includes Northern Ireland in the 1970s and ETA in the 1980s which is not quite the same."

He went on to say "ETA and IRA conflicts were localised not global, secondly, it could be argued that they were liberation movements in search of a political solution and as a result they had the sympathy of parties on the Left. Corbyn and Livingstone supported Sinn Fein but not Al Qaeda or ISIS."

Essentially these comments served well to emphasise my point. Can we say that people killed in Ireland by the IRA are less dead than people killed in Paris by Islamic extremists? Or that the families of the dead are comforted that Jeremy Corbyn liaised with Gerry Adams when he was otherwise shut out of the political discourse. I think probably not.

In my view, the comments are evidence of an underlying cognitive bias, which leads people to ignore facts and align with a dominant narrative. I was inspired to do my own analysis of the [Global Terrorism Database](https://www.start.umd.edu/gtd/) which I present here:

The first thing I did was make sure I could reproduce the [original plot][1] (or something close), given the same source data:

```{r getDataLocal, cache=TRUE}
gtd <- read.csv("gtd.csv")
```

```{r tidyData}
gtdwe <- gtd[gtd$region_txt == "Western Europe" &
               gtd$nkill > 0 & !(is.na(gtd$nkill))
            , c("eventid", "iyear", "country_txt", "nkill", "gname")]

gtdwe <- within(gtdwe, {
  country_txt <- ifelse(country_txt %in% c("Italy", "France"
                                           , "Germany", "United Kingdom", "Spain")
         , as.character(country_txt), "Other")
})
countries <- as.vector(unique(gtdwe$country_txt))
tergroups <- as.vector(unique(gtdwe$gname))
gtdwe <- within(gtdwe, {
  country <- factor(as.vector(country_txt), levels = countries)
  tergroup <- factor(as.vector(gname), levels = tergroups)
})

gtdfatals <- tapply(gtdwe$nkill, INDEX = list(gtdwe$iyear, gtdwe$country), FUN = sum, na.rm = TRUE)
gtdfatals <- data.frame(year = rownames(gtdfatals), gtdfatals)
gtdfatals <- melt(id.vars = "year"
                  , variable.name = "country"
                  , value.name = "fatalities"
                  , data = gtdfatals)
gtdfatals <- gtdfatals[!is.na(gtdfatals$fatalities),]
gtdfatals <- within(gtdfatals, {
  year <- factor(year, c(2015, rev(levels(year))))
})
gtdfatals <- rbind(gtdfatals, list(2015, "France", 140))
```

```{r basePlot}
gg <- ggplot(data = gtdfatals
             , aes(x = year, y = fatalities, fill = country))
gg + geom_bar(stat = "identity") + 
  coord_flip() + theme_bw() + theme(legend.position="top"
                                    , axis.text.y = element_text(size=6)) +
  labs(title = "Victims of Terrorist Attacks in Western Europe", y = "Number of fatalities", x = "Year")
```

That's a pretty good facsimile, if you ignore the lack of colour co-ordination. The freely available [Global Terrorism Database](https://www.start.umd.edu/gtd/) contains data only up to 2014. Huffington Post's statistical consultant probably added 2015-16 from other sources, although they don't tell us that. I've added a value of 140 fatalities in France for 2015.

On initial visual assessment, the eye is drawn to the mountain of bars representing the 70's and 80's and the relative sparsity from the mid-90's onwards. There are only the 4 notable peaks in 2004 (Madrid / Al Qaeda), 2005 (London / British born, Al-Qaeda inspired), 2011 (Norway, Right-wing extremist) and 2015 (Paris, Islamist terror cell).

To examine more closely the different trends in localised terrorism compared to international extremism  it's necessary to determine which are the local and international terror groups in the subset of the data pertaining to Western Europe and incidents with 1 or more fatality. 

I went through the list and labelled all the groups that I could be sure about (e.g. Basque separatists and Irish Republicans, compared to Liberate Palestine or "Iranians"). I share my categories in the appendices. Any advice on making it more accurate is most welcome.

```{r groupsData}
gtdgroups <- tapply(gtdwe$nkill, INDEX = list(gtdwe$iyear, gtdwe$gname), FUN = sum, na.rm = TRUE)
gtdgroups <- data.frame(year = rownames(gtdgroups), gtdgroups)
gtdgroups <- melt(id.vars = "year"
                  , variable.name = "tergroup"
                  , value.name = "fatalities"
                  , data = gtdgroups)
gtdgroups <- gtdgroups[!is.na(gtdgroups$fatalities),]
gtdgroups <- within(gtdgroups, {
  year <- factor(year, c(2015, rev(levels(year))))
  tergroup <- factor(tergroup, levels = unique(tergroup))
  levels(tergroup) <- c(levels(tergroup), "Lockerbie", "Paris.Attacks")
})
gtdgroups <- rbind(gtdgroups, list(2015, "Paris.Attacks", 140))

gtdgroups[gtdgroups$year == 1988 &
            gtdgroups$tergroup == "Unknown"
          , "tergroup"] <- "Lockerbie"

tervars <- read.csv("tervars.csv", stringsAsFactors = FALSE)
tervars$X <- NULL
# prepare for the join
gtdgroups$tergroup <- as.vector(gtdgroups$tergroup)

gtdgroups <- left_join(gtdgroups, tervars) %>%
  mutate(tergroup = factor(tergroup))

gtdgroups <- within(gtdgroups, {
  tergroup <- factor(tergroup)
  internationalextremism <- factor(intext, labels = c("No", "Yes"))
  adjustedlocalism <- fatalities * (1 - 0.9 * local)
  adjustedjckl <- adjustedlocalism * (1 - 0.75 * jckl)
  adjustedmemory <- fatalities  * (1 - as.numeric(gtdgroups$year)/45)
  adjustedall <- adjustedjckl * (1 - as.numeric(gtdgroups$year)/45)
})

DeathsAll <- with(gtdgroups, tapply(fatalities, internationalextremism, sum))
DeathsGFA <- with(gtdgroups[as.numeric(as.character(gtdgroups$year)) >= 2000,], tapply(fatalities, internationalextremism, sum))
DeathsAllAve <- with(gtdgroups, tapply(fatalities, internationalextremism, mean))
DeathsGFAAve <- with(gtdgroups[as.numeric(as.character(gtdgroups$year)) >= 2000,], tapply(fatalities, internationalextremism, mean))
```

Of all the deaths from terrorism recorded in the database since 1970 - 2014, how many are from Intenational terrorism?

```{r}
cat("International\n", names(DeathsAll), "\n", DeathsAll)
```

Judging by the numbers here, `r round(DeathsAll[1]/DeathsAll[2],1)` times as many deaths were caused by localised terrorism between 1970 and 2015. 

Given many of these groups have been much quieter since September 11th bombings of 2001 and we've had the Good Friday Agreement (GFA) working well since December 1999, it might help to look at the balance since the GFA:

```{r}
cat("International\n", names(DeathsGFA), "\n", DeathsGFA)
```

The balance has shifted to `r round(DeathsGFA[2]/DeathsGFA[1],1)` as many deaths from international terrorists as localised terrorism. The international threat must feel more current, but is still altogether out of balance given the totals.

Here's the same graph with the local vs international split highlighted:

```{r}
gg <- ggplot(data = gtdgroups
             , aes(x = year, y = fatalities))
gg + geom_bar(stat = "identity", aes(fill = internationalextremism)) +
  coord_flip() + theme_bw() + theme(legend.position="top"
                                    , axis.text.y  = element_text(size=6)) +
  labs(title = "Victims of Terrorist Attacks in Western Europe", y = "Number of fatalities", x = "Year")
```

One could conclude that those 388 deaths caused by global terrorists in the years since the GFA are almost entirely accounted for in Madrid and London bombings and the Paris attacks. Clearly these are very deadly incidents.

What is the average number of deaths per incident (rounded to nearest integer)?

```{r}
cat("International\n", names(DeathsAllAve), "\n", round(DeathsAllAve, 0))
```

Since the GFA?

```{r}
cat("International\n", names(DeathsGFAAve), "\n", round(DeathsGFAAve, 0))
```

Tthe modern extremist threat is a lot more deadly per incident, but also a good deal more rare. This is something else that can easily be visualised:

```{r}
gg2 <- ggplot(data = gtdgroups
             , aes(x = year)) 
gg2 + geom_bar(stat = "count", aes(fill = internationalextremism)) +
  scale_x_discrete(drop = FALSE) +
  coord_flip() + theme_bw() + theme(legend.position="top"
                                    , axis.text.y = element_text(size=6)) +
  labs(title = "Number of terrorist incidents
       resulting in fatality in Western Europe"
       , y = "Number of incidents", x = "Year")
```

Here, the localised terror groups absolutely dominate the graph, indicating that there was a far more constant and continuous threat in the past. All incidents are rapidly diminishing in number to the present day.

Extracting the international extremist incidents and looking at them separately gives the following rather revealing graph:

```{r}
gg3 <- ggplot(data = gtdgroups[gtdgroups$internationalextremism == "Yes",]
             , aes(x = year)) 
gg3 + geom_bar(stat = "count") +
  scale_x_discrete(drop = FALSE) +
  coord_flip() + theme_bw() + theme(legend.position="top"
                                    , axis.text.y = element_text(size=6)) +
  labs(title = "Number of terrorist incidents
       committed by international extremists
       resulting in fatality in Western Europe"
       , y = "Number of incidents", x = "Year")
```

This is the clearest evidence that global terror attacks are much rarer than localised groups over period 1970-2015. They have also become far more rare in recent years since the 1990's. This is completely counter to the suggestion that there is a greater danger now, or that trends between localised and global terror can't be compared.

What is clear is that when they strike they are much deadlier per incident and are therefore more newsworthy. This corroborates the point of the original post, that cognitive bias accounts for our fear, not the facts. 

### Appendices
The original chart from the [article in the Huffington Post](http://www.huffingtonpost.co.uk/2015/11/28/islamic-state-terrorism-threat_n_8670458.html)

![barchart of fatalities][1]

[1]: GTD_files\\figure-html\\o-TERRORISM-570.jpg "Victims of Terrorist Attacks in Western Europe"

The catogories applied to the various terror groups:
```{r}
cats <- unique(gtdgroups[, c("tergroup", "internationalextremism")])
cats[,1] <- abbreviate(as.character(cats[,1]), minlength = 40)
cats
```

