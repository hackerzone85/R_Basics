```{r prologue, results='hide', echo=FALSE}
knitr::opts_chunk$set(warning = FALSE
                      , message = FALSE
                      , echo = FALSE
                      )
```

```{r setup}
require(vcd)
require(lattice)
require(directlabels)
```

# Visualising Categorical Data

#### Exercise 3.1 The Arbuthnot data in HistData (Example 3.1) also contains the variable Ratio, giving the ratio of male to female births.

(a)	Make a plot of Ratio over Year, similar to Figure 3.1. What features stand out? Which plot do you prefer to display the tendency for more male births?

*Here is the original plot referred to in the question:*

```{r}
# op <- par(mar = c(4,4,1,1) + .1, cex.lab = 1.25)

data("Arbuthnot", package = "HistData")

with(Arbuthnot, {
  prob = Males / (Males + Females)
  plot(x = Year, y = prob, type = "b",
       ylim = c(0.5, 0.54)
       , ylab = "Pr (Male)"
       , main = "Arbuthnot's data on male/female sex ratios in London, 1629-1710")
  abline(h = 0.5, col = "red", lwd = 2)
  abline(h = mean(prob), col = "blue")
  lines(loess.smooth(Year, prob), col = "blue", lwd = 2)
  text(x = 1640, y = 0.5, expression(H[0]: "Pr(Male)=0.5"),
       pos = 3, col = "red")
  })
```



```{r}
with(Arbuthnot, {
  plot(x = Year, y = Ratio, type = "b"
       , ylim = c(1, max(Ratio) + 0.01)
       , ylab = "Pr (Male)"
       , main = "Same plot, this time against ratio")
  abline(h = 1, col = "red", lwd = 2)
  abline(h = mean(Ratio), col = "blue") 
  lines(loess.smooth(Year, Ratio), col = "blue", lwd = 2)
  text(x = 1640, y = 1, expression(H[0]: "Ratio Male:Female = 1"),
       pos = 3, col = "red")
  })
```

*The plots are essentially identical. The choice to use either would depend on context and audience.*

(b)	Plot the total number of christenings, Males + Females or Total (in 000s) over time. What unusual features do you see?

```{r}
with(Arbuthnot, {
  TotC <- (Males + Females)/1000
  plot(x = Year, y = TotC, type = "b"
       , ylab = "Christenings (thousands)"
       , main = "Total number of Christenings (Arbuthnot's data)"
       )
  lines(loess.smooth(Year, TotC, degree = 1), col = "blue", lwd = 2)
  })
```

*There is a linear increasing trend which is interrupted for almost two decades, presumably by plague. There is a second unexpected dip at around 1705.*

#### Exercise 3.2 Use the graphical methods illustrated in Section 3.2 to plot a collection of geometric distributions for p = 0.2, 0.4, 0.6, 0.8, over a range of values of k = 0, 1, â€¦ 10.

(a)	With xyplot(), try the different plot formats using points connected with lines, as in Figure 3.9, or using points and lines down to the origin, as in the panels of Figure 3.10.

```{r}
PL <- expand.grid(k = 0 : 10
                  , probs = c(0.2, 0.4, 0.6, 0.8))
geom_df <- data.frame(PL, prob = dgeom(PL$k, PL$probs))
geom_df$probs = factor(geom_df$probs)
str(geom_df)

xyplot(prob ~ k | probs, data = geom_df,
       type = c("h", "p"), pch = 16, lwd = 2, cex = 1.25, layout = c(2, 2),
       xlab = list("Number of events (k)", cex = 1.25),
       ylab = list("Probability", cex = 1.25))
```

(b)	Also with xyplot (), produce one version of a multi-line plot in a single panel that you think shows well how these distributions change with the probability p of success.

```{r}
# use direct labels as an alternative way to legend a plot (lattice)
mycol <- palette()[2:5]
plt <- xyplot(prob ~ k, data = geom_df, groups = probs,
              type = "b", pch = 15 : 18, lwd = 2, cex = 1.25, col = mycol,
              xlab = list("Number of events (k)", cex = 1.25),
              ylab = list("Probability",  cex = 1.25),
              ylim = c(0, 1)
              )

library(directlabels)
direct.label(plt, list("top.points", cex = 1.5, dl.trans(y = y + 0.1)))
```

(c)	Do the same in a multi-panel version, conditional on p.

```{r}
# use direct labels as an alternative way to legend a plot (lattice)
mycol <- palette()[2:5]
plt <- xyplot(prob ~ k | probs, data = geom_df, groups = probs,
              layout = c(2,2),
              type = "b", pch = 15 : 18, lwd = 2, cex = 1.25, col = mycol,
              xlab = list("Number of events (k)", cex = 1.25),
              ylab = list("Probability",  cex = 1.25),
              ylim = c(0, 1)
              )

library(directlabels)
direct.label(plt, list("top.points", cex = 1.5, dl.trans(y = y + 0.1)))
```
